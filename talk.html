<!DOCTYPE html>
<html>
  <head>
    <title>Measuring Chronic Pain Outcomes with Twilio and Ruby</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Raleway);
      @import url(https://fonts.googleapis.com/css?family=PT+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Raleway'; }
      h1, h2 {
        font-family: 'PT Serif';
        font-weight: normal;
      }
      h3 {
        font-family: 'Raleway';
        font-weight: normal;
      }
      .strong {
        font-weight: bolder;
      }
      .big {
        font-size: 30px;
      }
      .bigger {
        font-size: 40px;
      }
      .biggest {
        font-size: 50px;
      }
      .big-bold {
        font-size: 40px;
        font-weight: bolder;
      }
      .white {
        color: white;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; font-size: 20px; }
    </style>
  </head>
  <body>
    <textarea id="source">

      name: primary-slide

      ---
      class: left

      # Measuring Chronic Pain Outcomes with Ruby and Twilio
      .left[![ruby](https://rebornix.gallerycdn.vsassets.io/extensions/rebornix/ruby/0.17.0/1520198344144/Microsoft.VisualStudio.Services.Icons.Default)]
      ---
      template: primary-slide

      # Order of the day:

      --

      ###1. Lay out a non-business 'problem' through a story

      --

      ###2. Discuss attacking that problem with the help of Ruby .big[üçñ]

      --

      ###3. Cover outcomes and retrospective observations

      --

      ###4. Underline the importance of using your Ruby <u>.strong['superpower']</u> .big[‚ù§Ô∏è]

      ---
      template: primary-slide
      class: center, middle

      #Who am I?

      ---
      template: primary-slide
      class: top, right
      background-image: url(https://i.imgur.com/VDbyqsS.jpg)
      background-size: cover
      ## .white[.strong[I used to live here]]

      ---
      template: primary-slide
      background-image: url(https://i.imgur.com/XEMQDAz.jpg)
      background-size: cover
      class: bottom, left
      # .white[.strong[Now I live here]]

      ---
      template: primary-slide

      # And I work here

      .center[![This is my image](https://pbs.twimg.com/profile_images/1122058292/ohq_avatar_400x400.jpg)]

      ---
      template: primary-slide

      # Where I do this

      .center[![If you are seeing this text everything has gone horribly wrong.](http://plenglish.com/images/2017/diciembre/17/barcos.jpg)]

      ---
      template: primary-slide
      class: center, middle
      # Today's talk has nothing to do about where I work.

      --
      .center[![image of laura and I](https://i.imgur.com/nEKCRhY.jpg)]

      ---
      template: primary-slide

      # 1. The problem

      ---
      template: primary-slide

      # Summer 2017

      --

      class: center, middle
      # ü§ï üöë

      ---
      template: primary-slide

      # What is Avascular Necrosis?

      .center[![This is my image](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQjCsNCxbPCoyFQg6bc3e9Hx_dDptogJSe4oCaH0zSrgOQpig0YzQ)]

      ---
      template: primary-slide

      .center[# ‚ùóÔ∏è]

      ???

      Dr. Said that the pressure swings will affect joint pain.

      ---
      template: primary-slide

      class: center, middle
      # ‚ùì
      # ü§î

      ???

      My hypothesis

      --
      .left[# Pain: nearly unpredictable]
      --
      .left[# Pressure systems: very predictable]
      ---
      template: primary-slide
      class: center, middle
      # Sit down at the negotiating table
      # üòº üòà

      ???

      Striking a deal with laura. It's all about compromise.

      ---
      template: primary-slide

      # She would help me track and measure her pain üìà ‚úîÔ∏è

      --

      # I would start counting my caloric intake every day üò± üç™

      ---
      template: primary-slide
      class: center, middle
      # 2. Solving this problem, with the aid of Ruby & Twilio

      --

      # Goal: extract as many data points with live pressure and pain readings as possible for processing at the end of the process.

      ---
      template: primary-slide

      # Setting up the Twilio Interface
      .center[# üëÄ]

      ???

      Twilio Chunk, talk about why twilio
      ---
      template: primary-slide

      # A web UI for this application was out of scope.

      ---
      template: primary-slide

      # DISCLAIMER:
      --
      .center[## I am NOT a Twilio API expert or genius-]
      --
      .center[## That's the point.]
      ---
      template: primary-slide

      # Twilio has some of the most out-of-the-box Ruby-Friendly documentation I have ever seen

      .center[![Twilio](https://i.imgur.com/PUjILMT.png)]

      ???

      That's how I was able to go from basically no Twilio experience at all, to spinning up a fully functioning Rails app.
      ---
      template: primary-slide

      # Fast setup - focus on the actual problem at hand and not the integration.
      --
      ##¬†Sign up, get your number, get your API Keys, get started
      --
      ```ruby
      # Taken directly from twilio documentation
      require 'twilio-ruby'

      account_sid = "ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" # Your Account SID from www.twilio.com/console
      auth_token = "your_auth_token"   # Your Auth Token from www.twilio.com/console

      @client = Twilio::REST::Client.new account_sid, auth_token
      message = @client.messages.create(
          body: "Hello from Ruby",
          to: "+12345678901",    # Replace with your phone number
          from: "+12345678901")  # Replace with your Twilio number

      puts message.sid
      ```

      ---
      template: primary-slide

      # Additional considerations for Rails...

      ---
      template: primary-slide
      # Weather Underground

      .center[![wu-logo](https://i.imgur.com/u1T8vO4.png)]

      ---
      template: primary-slide
      ## sdague/weather-underground.rb

      .center[![wu-gem](https://i.imgur.com/LiN8KWL.png)]

      ---
      template: primary-slide

      # Side note - units of measure for barometric pressure:

      * SI: 101kPa (1 pascal = 1 newton per square metre, 1 N/m2)
      * USA: 15psi
      * Inches of Mercury: 29.53"
      * Millibars: 1013.25 mbar ü§î
      * Atm: 1

      ---
      template: primary-slide

      .center[# Rails Backend - deployed on Heroku]

      ???

      Data modeling chunk

      ---
      template: primary-slide

      # Simple object

      ```ruby
      #<DataPoint:0x00000005e89a18> {
                           :id => 115,
          :barometric_pressure => 1014.56146291907,
                   :pain_level => 4.0,
                   :created_at => Sun, 17 Sep 2017 10:26:31 UTC +00:00,
                   :updated_at => Sun, 17 Sep 2017 10:26:31 UTC +00:00
      }
      ```

      ---
      template: primary-slide

      # Simple object

      ```ruby
      #<DataPoint:0x00000005e89a18> {
                           :id => 115,
          :barometric_pressure => 1014.56146291907, # <---
          template: primary-slide- What I really care about
                   :pain_level => 4.0,              # <---
                   template: primary-slide-
                   :created_at => Sun, 17 Sep 2017 10:26:31 UTC +00:00,
                   :updated_at => Sun, 17 Sep 2017 10:26:31 UTC +00:00
      }
      ```

      ---
      template: primary-slide

      # Learning to interact with the user, the most difficult part

      ---
      template: primary-slide

      # The core flow:

      * Random messaging 5x/day ‚úâÔ∏è
      * Capture pain reading üìà
      * Marry reading to live barometric pressure üå™
      * Handle as many edge cases as possible üò∞

      ???

      Explain the randomness of the flow with a rake task here.

      ---
      template: primary-slide

      class: center, middle
      # Unexpected user inputs
      --
      .left[* `'F OFF'`]
      ---
      template: primary-slide
      class: center, middle
      # Unexpected user inputs
      .left[* `'F OFF'.to_i == 0`]
      --
      ```ruby
      if invalid_entry_response
        "Huh. Okay. Well, #{pain_level} is not going to get recorded in this system. You know I have the power to text nick with what you are saying if you are TOO naughty."
      ```
      --
      .left[* `66`]
      --
      .left[* Inline adjustments, and retrospective data analysis adjustments]

      ???

      Some things were dealt with with inline realtime improvements and some with data sanitizing at the end.

      ---
      template: primary-slide

      class: center, middle
      # Encourage user input

      ---
      template: primary-slide
      class: center, middle
      ## Ensure that the response was sensitive to the situation

      #¬†Giphy integration

      .center[![You better not see this text](https://gph.is/1aPAh1Z)]
      ---
      template: primary-slide

      ## Hook up response
      ```ruby
      type = ['funny', 'cat', 'dancing'].sample
      gif = RestClient.get("https://api.giphy.com/v1/gifs/search?api_key=#{api_key}=#{type}&limit=25&offset=0&rating=G&lang=en")
      selector = (0..23).to_a.sample
      "Saved! #{JSON.parse(gif)['data'][selector]['bitly_gif_url']}"
      ```

      [!catgif](images/cat.gif)

      ---
      template: primary-slide

      ## Ensure that the response was sensitive to the situation

      ```ruby
      if pain_level.to_f >= 7.0
        painful_message
        # Note: Gifs were *never* appropriate on high-pain days.
      elsif pain_level.to_f < 4.0
        [less_pain_message, gif_message].sample
      else
        [middle_pain_message, gif_message].sample
      end
      ```

      ---
      template: primary-slide
      # Light hearted on the easier days

      ```ruby
      def less_pain_message
        [
          'Successfully saved. Thanks for putting up with this app, it means a lot to nick',
          'Data has been logged. Wow, we are gonna have a good chunk of data points!',
          'Saved. You probably think this is all a bunch of random messages nick entered. NOPE! I\'m real! I live inside your phone! help!',
          'Saved! Hope that your pain levels stay low bee bop!',
          'Saved- fingers crossed your numbers stay good',
          'Boom! Loving those low numbers. Hope it stays low!',
          'Got it saved. Wonder if the pressure is working in your favor?'
        ].sample
      end
      ```
      ---
      template: primary-slide
      # Light hearted on the easier days

      ```ruby
      def less_pain_message
        [
          'Successfully saved. Thanks for putting up with this app, it means a lot to nick',
          'Data has been logged. Wow, we are gonna have a good chunk of data points!',
          'Saved. You probably think this is all a bunch of random messages nick entered. NOPE! I\'m real! I live inside your phone! help!',
          # ^^^^ My favorite üôÇ
          'Saved! Hope that your pain levels stay low bee bop!',
          'Saved- fingers crossed your numbers stay good',
          'Boom! Loving those low numbers. Hope it stays low!',
          'Got it saved. Wonder if the pressure is working in your favor?'
        ].sample
      end
      ```
      ---
      template: primary-slide

      # Support on the rough days

      ```ruby
      def painful_message
        ['This saved, but honey are you okay? Tell nick you just wanna chill tonight.',
          'I have got this in the system. Sorry you are hurting :(',
          'Saved successfully. I hope you are not fed up with this app, just know that the information you provide could be really, really helpful.',
          'Logged! Fingers crossed that these numbers will go down after the surgery...',
          'Saved. Thank you for being so good about sending this data in...',
          'Got it. Be sure to take it easy and not push yourself if you are sore!',
          'You should take a night off on the couch and make nick cook and clean and get you lots of tea. Modern Family night?'
        ].sample
      end
      ```
      ---
      template: primary-slide
      class: center, middle
      # 3. Outcomes and retrospectives
      ---
      template: primary-slide
      class: center, middle
      # How we view pain

      .left[* Pain is incredibly subjective]
      .left[* Hospital stay tried to make it objective]
      .left[* Laura had become *very* good at monitoring pain to her standard]
      .left[* !>5? no relief for you]
      .left[* Adjustment for the race to the top]

      ---
      template: primary-slide

      class: center, middle
      # Making things mobile

      .left[* Since we traveled very little during this time, I would manually reset the coordinates when we visited family elsewhere, etc]
      .left[* This would benefit from location tracking which I was reluctant to do, and wouldn't want to build a native app just to have that]

      ---
      template: primary-slide
      class: center, middle
      # How do we best process this information?

      ---
      template: primary-slide

      # Dump information into a two dimensional array

      ```ruby
      def valid_readings(pain_level)
        pain_level > 0.0 && pain_level < 10.0
      end

      array = []
      DataPoint.all.each do |dp|
        array << [dp.barometric_pressure, dp.pain_level] if valid_readings(dp.pain_level)
      end
      ```
      ---
      template: primary-slide

      # Write to CSV to share outside of the programming community

      ```ruby
      require 'csv'
      CSV.open("laura_stats.csv", "w") do |csv|
        array.map{|row| csv << row}
      end
      ```
      ---
      template: primary-slide

      # Visualize with a Graph

      .center[![graph](https://i.imgur.com/dm7Sp4M.png)]

      ---
      template: primary-slide

      # SVM in Ruby

      .center[![blog-image](https://i.imgur.com/IB1YGUE.png)]

      ???

      Support Vector Machine (SVM) is a supervised learning algorithm developed by Vladimir Vapnik and his co-workers at AT&T Bell Labs in the mid 90's.

      At their core, SVMs are a method for creating a predictor function from a set of training data where the function itself can be a binary, a multi-category, or even a general regression predictor. To accomplish this mathematical feat, SVMs find a hypersurface (for example, a plane in 2D) which attempts to split the positive and negative examples with the largest possible margin on all sides of the (hyper)plane.
      ---
      template: primary-slide

      # Standing on the shoulders of giants

      ### (`daugaard/example-svm`)

      ![repo-photo](https://i.imgur.com/UVskqfI.png)

      ???

      Discuss finding blog post on ruby weekly

      ---
      template: primary-slide

      # Finding the 'best' C and Gamma values

      #![ruby-shot](https://i.imgur.com/L3OKGwB.png)

      ???

      ** Explain C parameter, and Gaussian paraemeter, also that we just care it's the two things we can tweak.

      The C parameter is similar to the regularization parameter Œª we know from other machine learning models, only C is the inverse of Œª. That is a larger C will give you lower bias and higher variance a model will have, where a low C will give you high bias and low variance.

      The Gamma parameter is a parameter specific to the Gaussian kernel (RBF in libsvm). The gamma parameter define how far a single training example will have influence. So that is how much influence will  a single training example have on examples that are further away from the training example.

      To find the optimal C and gamma parameters we are going to create a program that iterates through possible values of C and gamma, and measures the classification accuracy for each combination and finds the best combination. Lastly the program will test the selected combination of C and gamma on unknown data to measure its general classification accuracy.

      To do this we must now split our data into 3. A training dataset using to train the model, a validation dataset used to test combinations of C and gamma and select the best one, and lastly a test dataset used to test the model using the optimal C and gamma parameters to find the classification accuracy. We use a split of 70% training data, 15% validation data and 15% test data.

      ---
      template: primary-slide

      # Best results I could garner:

      .center[# `Test Generalization Accuracy: 24.43% - C=5, gamma=1`]

      ---
      template: primary-slide

      # What if I cared more about 'close' than 'exact?'
      ```ruby
      correct = predicted.collect.with_index do |e,i|
        if (e.to_f - validation_y_data[i].to_f).magnitude <= 1.0
          1
        else
          0
        end
      end.inject{ |sum,e| sum+e }
      ```
      ---
      template: primary-slide
      # Within 1:
      ## `Test Generalization Accuracy: 60.34%`
      # Within 2:
      ## `Test Generalization Accuracy: 89.66%`

      ---
      template: primary-slide
      # One more takeaway

      .center[![graph](https://i.imgur.com/dm7Sp4M.png)]

      ???

      Nothing under 4 over certain pressure

      ---
      template: primary-slide

      # Other thoughts on future processing:

      ##* Measure 'closeness'
      ##* Increase dataset size
      ##* Publish dataset for analysis from fellow Rubyists

      ---
      template: primary-slide

      # WIP: Forecasting

      ---
      template: primary-slide
      class: center, middle
      # 4. Using our superpower, for good

      ---
      template: primary-slide
      class: center, middle
      * It's not a choice between 'working for the man' and 'toy projects'
      --
      * Not everyone can do what you do
      --
      * What is a few minutes of mindless scripting for you may be life changing for someone else
      --
      * New tooling opportunities

      ---
      template: primary-slide

      # Wrapup:

      1. Lay out a non-business 'problem' through a story
      2. Discuss attacking that problem with the help of 'Ruby' üçñ
      3. Cover outcomes and retrospective observations
      4. Underline the importance of using your Ruby 'superpower' ‚ù§Ô∏è

      ---
      template: primary-slide

      # Thanks for your time!

      ### schwad.github.io (slides will be published here)
      ### @schwad4hd14 (twitter)
      ### github.com/schwad
      ### nicholas.schwaderer@gmail.com
      ### Let's grow this project

      ---
      template: primary-slide


      # END

      ---
      template: primary-slide

      ##¬†GOAL: forecasting someday
      ##¬†setting up the app
      ## Do a slide about hospital stay before THEN do machine learning

      ---
      template: primary-slide

      ## Reformatting the iterations with regards to messaging user (3-4 slides of code)

      ## Setting up things for machine learning (3-4 slides, include original blog that inspired me and show code)

      ## The final run through (3-4 slides to get results working)

      ## Final conclusions only 24% going together

      ## However, never under a 4 under x

      ---
      template: primary-slide

      # GENERAL RESOURCES FOR SELF

      --> styling remark


      --> code notes

      ---
      template: primary-slide

      ## READ UP ON SVMS, C AND GAMMA SHIT IN GENERAL TO AT LEAST BE HALF AN AUTHORITY ON IT. MONDAY

      # show images correctly
      # correct formatting
      # improve style?
      # practice with it, rearrange as needed
      # practice dual monitors and also pimping out notes

      ---

    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create({
        slideNumberFormat: ''
      });
    </script>
  </body>
</html>
